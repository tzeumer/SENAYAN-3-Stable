<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Senayan3: admin/modules/serial_control/serial_base_lib.inc.php Source File</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<link href="../../styles.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<script type="text/javascript">
<!--
function changeDisplayState (e){
  var num=this.id.replace(/[^[0-9]/g,'');
  var button=this.firstChild;
  var sectionDiv=document.getElementById('dynsection'+num);
  if (sectionDiv.style.display=='none'||sectionDiv.style.display==''){
    sectionDiv.style.display='block';
    button.src='../../open.gif';
  }else{
    sectionDiv.style.display='none';
    button.src='../../closed.gif';
  }
}
function initDynSections(){
  var divs=document.getElementsByTagName('div');
  var sectionCounter=1;
  for(var i=0;i<divs.length-1;i++){
    if(divs[i].className=='dynheader'&&divs[i+1].className=='dynsection'){
      var header=divs[i];
      var section=divs[i+1];
      var button=header.firstChild;
      if (button!='IMG'){
        divs[i].insertBefore(document.createTextNode(' '),divs[i].firstChild);
        button=document.createElement('img');
        divs[i].insertBefore(button,divs[i].firstChild);
      }
      header.style.cursor='pointer';
      header.onclick=changeDisplayState;
      header.id='dynheader'+sectionCounter;
      button.src='../../closed.gif';
      section.id='dynsection'+sectionCounter;
      section.style.display='none';
      section.style.marginLeft='14px';
      sectionCounter++;
    }
  }
}
window.onload = initDynSections;
-->
</script>
  <div class="navpath"><a class="el" href="../../dir_6de39a8a908f1ef62430a35acd8f39df.html">admin</a>&nbsp;&raquo&nbsp;<a class="el" href="../../dir_007c3694345442a4fc6aa8eb0561a387.html">modules</a>&nbsp;&raquo&nbsp;<a class="el" href="../../dir_953ea5e0c5fd285c45fa66a6e80fa669.html">serial_control</a>
  </div>
<div class="contents">
<h1>serial_base_lib.inc.php</h1><a href="../../d4/d08/serial__base__lib_8inc_8php.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 &lt;?php
<a name="l00002"></a>00002 <span class="preprocessor">##</span>
<a name="l00003"></a>00003 <span class="preprocessor"></span><span class="preprocessor">#  Copyright (C) 2007,2008  Arie Nugraha (dicarve@yahoo.com)</span>
<a name="l00004"></a>00004 <span class="preprocessor"></span><span class="preprocessor"># </span>
<a name="l00005"></a>00005 <span class="preprocessor"></span><span class="preprocessor">#  This program is free software; you can redistribute it and/or modify</span>
<a name="l00006"></a>00006 <span class="preprocessor"></span><span class="preprocessor">#  it under the terms of the GNU General Public License as published by</span>
<a name="l00007"></a>00007 <span class="preprocessor"></span><span class="preprocessor">#  the Free Software Foundation; either version 2 of the License, or</span>
<a name="l00008"></a>00008 <span class="preprocessor"></span><span class="preprocessor">#  (at your option) any later version.</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span><span class="preprocessor"># </span>
<a name="l00010"></a>00010 <span class="preprocessor"></span><span class="preprocessor">#  This program is distributed in the hope that it will be useful,</span>
<a name="l00011"></a>00011 <span class="preprocessor"></span><span class="preprocessor">#  but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<a name="l00012"></a>00012 <span class="preprocessor"></span><span class="preprocessor">#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
<a name="l00013"></a>00013 <span class="preprocessor"></span><span class="preprocessor">#  GNU General Public License for more details.</span>
<a name="l00014"></a>00014 <span class="preprocessor"></span><span class="preprocessor"># </span>
<a name="l00015"></a>00015 <span class="preprocessor"></span><span class="preprocessor">#  You should have received a copy of the GNU General Public License</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span><span class="preprocessor">#  along with this program; if not, write to the Free Software</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span><span class="preprocessor">#  Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span><span class="preprocessor">##</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span>
<a name="l00025"></a><a class="code" href="../../d8/dc6/classserial.html">00025</a> <span class="keyword">class </span><a class="code" href="../../d8/dc6/classserial.html">serial</a>
<a name="l00026"></a>00026 {
<a name="l00027"></a><a class="code" href="../../d8/dc6/classserial_a3ef8066a7a7c2c4ce4b7a20e4b7f1bc7.html#a3ef8066a7a7c2c4ce4b7a20e4b7f1bc7">00027</a>     <span class="keyword">private</span> <a class="code" href="../../d8/dc6/classserial_a3ef8066a7a7c2c4ce4b7a20e4b7f1bc7.html#a3ef8066a7a7c2c4ce4b7a20e4b7f1bc7">$obj_db</a> = null;
<a name="l00028"></a><a class="code" href="../../d8/dc6/classserial_ab85d23dbe181ec1dca3150a8aa0799c7.html#ab85d23dbe181ec1dca3150a8aa0799c7">00028</a>     <span class="keyword">private</span> <a class="code" href="../../d8/dc6/classserial_ab85d23dbe181ec1dca3150a8aa0799c7.html#ab85d23dbe181ec1dca3150a8aa0799c7">$serial_id</a> = 0;
<a name="l00029"></a><a class="code" href="../../d8/dc6/classserial_a5ad18fddc8ee1c741e46c0c7ff7812e9.html#a5ad18fddc8ee1c741e46c0c7ff7812e9">00029</a>     <span class="keyword">private</span> <a class="code" href="../../d8/dc6/classserial_a5ad18fddc8ee1c741e46c0c7ff7812e9.html#a5ad18fddc8ee1c741e46c0c7ff7812e9">$serial_date_start</a>;
<a name="l00030"></a><a class="code" href="../../d8/dc6/classserial_a2564b4eb660d2dbcb91f87e177b7b470.html#a2564b4eb660d2dbcb91f87e177b7b470">00030</a>     <span class="keyword">private</span> <a class="code" href="../../d8/dc6/classserial_a2564b4eb660d2dbcb91f87e177b7b470.html#a2564b4eb660d2dbcb91f87e177b7b470">$serial_period</a>;
<a name="l00031"></a><a class="code" href="../../d8/dc6/classserial_a71f5dec86e139ea7d12c200fc556c115.html#a71f5dec86e139ea7d12c200fc556c115">00031</a>     <span class="keyword">private</span> <a class="code" href="../../d8/dc6/classserial_a71f5dec86e139ea7d12c200fc556c115.html#a71f5dec86e139ea7d12c200fc556c115">$frequency_time_unit</a> = <span class="stringliteral">&apos;month&apos;</span>;
<a name="l00032"></a><a class="code" href="../../d8/dc6/classserial_abd4039d2051b9da0de79399c198d5d41.html#abd4039d2051b9da0de79399c198d5d41">00032</a>     <span class="keyword">private</span> <a class="code" href="../../d8/dc6/classserial_abd4039d2051b9da0de79399c198d5d41.html#abd4039d2051b9da0de79399c198d5d41">$frequency_increment</a> = 30;
<a name="l00033"></a><a class="code" href="../../d8/dc6/classserial_aa2f0fdc7a32c068689f399181f235a4c.html#aa2f0fdc7a32c068689f399181f235a4c">00033</a>     <span class="keyword">private</span> <a class="code" href="../../d8/dc6/classserial_aa2f0fdc7a32c068689f399181f235a4c.html#aa2f0fdc7a32c068689f399181f235a4c">$biblio_id</a> = 0;
<a name="l00034"></a>00034 
<a name="l00040"></a><a class="code" href="../../d8/dc6/classserial_a5dc2bb9ecfb66fcde242415406358ba6.html#a5dc2bb9ecfb66fcde242415406358ba6">00040</a>     <span class="keyword">public</span> function <a class="code" href="../../d8/dc6/classserial_a5dc2bb9ecfb66fcde242415406358ba6.html#a5dc2bb9ecfb66fcde242415406358ba6">__construct</a>(<a class="code" href="../../d8/dc6/classserial_a3ef8066a7a7c2c4ce4b7a20e4b7f1bc7.html#a3ef8066a7a7c2c4ce4b7a20e4b7f1bc7">$obj_db</a>, $int_serial_id = 0)
<a name="l00041"></a>00041     {
<a name="l00042"></a>00042         $this-&gt;obj_db = <a class="code" href="../../d8/dc6/classserial_a3ef8066a7a7c2c4ce4b7a20e4b7f1bc7.html#a3ef8066a7a7c2c4ce4b7a20e4b7f1bc7">$obj_db</a>;
<a name="l00043"></a>00043         $this-&gt;serial_id = $int_serial_id;
<a name="l00044"></a>00044         <span class="comment">// get serial data</span>
<a name="l00045"></a>00045         $_serial_q = $this-&gt;obj_db-&gt;query(<span class="stringliteral">&apos;SELECT * FROM serial AS sr LEFT JOIN biblio AS b ON sr.biblio_id=b.biblio_id</span>
<a name="l00046"></a>00046 <span class="stringliteral">            LEFT JOIN mst_frequency AS fr ON b.frequency_id=fr.frequency_id WHERE sr.serial_id=&apos;</span>.$this-&gt;serial_id);
<a name="l00047"></a>00047         $_serial_d = $_serial_q-&gt;fetch_assoc();
<a name="l00048"></a>00048         <span class="comment">// set properties</span>
<a name="l00049"></a>00049         $this-&gt;serial_date_start = $_serial_d[<span class="stringliteral">&apos;date_start&apos;</span>];
<a name="l00050"></a>00050         $this-&gt;serial_period = $_serial_d[<span class="stringliteral">&apos;period&apos;</span>];
<a name="l00051"></a>00051         $this-&gt;frequency_increment = $_serial_d[<span class="stringliteral">&apos;time_increment&apos;</span>];
<a name="l00052"></a>00052         $this-&gt;frequency_time_unit = $_serial_d[<span class="stringliteral">&apos;time_unit&apos;</span>];
<a name="l00053"></a>00053         $this-&gt;biblio_id = $_serial_d[<span class="stringliteral">&apos;biblio_id&apos;</span>];
<a name="l00054"></a>00054     }
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 
<a name="l00063"></a><a class="code" href="../../d8/dc6/classserial_acf7d8a4d6e42117b1fa6b702a5d58fe8.html#acf7d8a4d6e42117b1fa6b702a5d58fe8">00063</a>     <span class="keyword">public</span> function <a class="code" href="../../d8/dc6/classserial_acf7d8a4d6e42117b1fa6b702a5d58fe8.html#acf7d8a4d6e42117b1fa6b702a5d58fe8">generateKardexes</a>($int_total_expl, $bool_insert_to_DB = <span class="keyword">true</span>)
<a name="l00064"></a>00064     {
<a name="l00065"></a>00065         <span class="keywordflow">if</span> ($int_total_expl &lt; 1) { $int_total_expl = 1; }
<a name="l00066"></a>00066         <span class="comment">// initialize kardex array</span>
<a name="l00067"></a>00067         $_kardex = array();
<a name="l00068"></a>00068 
<a name="l00069"></a>00069         $_parsed_date = date_parse($this-&gt;serial_date_start);
<a name="l00070"></a>00070         $_year = $_parsed_date[<span class="stringliteral">&apos;year&apos;</span>];
<a name="l00071"></a>00071         $_month = $_parsed_date[<span class="stringliteral">&apos;month&apos;</span>];
<a name="l00072"></a>00072         $_day = $_parsed_date[<span class="stringliteral">&apos;day&apos;</span>];
<a name="l00073"></a>00073         $_curr_date = date(<span class="stringliteral">&apos;Y-m-d&apos;</span>);
<a name="l00074"></a>00074 
<a name="l00075"></a>00075         <span class="keywordflow">for</span> ($_k=0; $_k&lt;$int_total_expl; $_k++) {
<a name="l00076"></a>00076             <span class="keywordflow">switch</span> ($this-&gt;frequency_time_unit) {
<a name="l00077"></a>00077                 <span class="keywordflow">case</span> <span class="stringliteral">&apos;day&apos;</span>:
<a name="l00078"></a>00078                     $_entry_date = date(<span class="stringliteral">&apos;Y-m-d&apos;</span>, mktime(0, 0, 0, $_month, $_day+($this-&gt;frequency_increment*$_k), $_year));
<a name="l00079"></a>00079                 <span class="keywordflow">break</span>;
<a name="l00080"></a>00080                 <span class="keywordflow">case</span> <span class="stringliteral">&apos;week&apos;</span>:
<a name="l00081"></a>00081                     $_entry_date = date(<span class="stringliteral">&apos;Y-m-d&apos;</span>, mktime(0, 0, 0, $_month, $_day+($this-&gt;frequency_increment*7*$_k), $_year));
<a name="l00082"></a>00082                 <span class="keywordflow">break</span>;
<a name="l00083"></a>00083                 <span class="keywordflow">case</span> <span class="stringliteral">&apos;month&apos;</span>:
<a name="l00084"></a>00084                     $_entry_date = date(<span class="stringliteral">&apos;Y-m-d&apos;</span>, mktime(0, 0, 0, $_month+($this-&gt;frequency_increment*$_k), $_day, $_year));
<a name="l00085"></a>00085                 <span class="keywordflow">break</span>;
<a name="l00086"></a>00086                 <span class="keywordflow">case</span> <span class="stringliteral">&apos;year&apos;</span>:
<a name="l00087"></a>00087                     $_entry_date = date(<span class="stringliteral">&apos;Y-m-d&apos;</span>, mktime(0, 0, 0, $_month, $_day, $_year+($this-&gt;frequency_increment*$_k)));
<a name="l00088"></a>00088                 <span class="keywordflow">break</span>;
<a name="l00089"></a>00089             }
<a name="l00090"></a>00090             $_seq = $_k+1;
<a name="l00091"></a>00091             <span class="comment">// append to kardex entry array</span>
<a name="l00092"></a>00092             $_kardex[$_seq] = $_entry_date;
<a name="l00093"></a>00093             <span class="comment">// insert to database</span>
<a name="l00094"></a>00094             <span class="keywordflow">if</span> ($bool_insert_to_DB) {
<a name="l00095"></a>00095                 @$this-&gt;obj_db-&gt;query(<span class="stringliteral">&quot;INSERT INTO kardex (date_expected, seq_number, serial_id, input_date, last_update)</span>
<a name="l00096"></a>00096 <span class="stringliteral">                    VALUES (&apos;$_entry_date&apos;, &apos;$_seq&apos;, &apos;&quot;</span>.$this-&gt;serial_id.<span class="stringliteral">&quot;&apos;, &apos;$_curr_date&apos;, &apos;$_curr_date&apos;)&quot;</span>);
<a name="l00097"></a>00097             }
<a name="l00098"></a>00098         }
<a name="l00099"></a>00099 
<a name="l00100"></a>00100         <span class="keywordflow">return</span> $_kardex;
<a name="l00101"></a>00101     }
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 
<a name="l00108"></a><a class="code" href="../../d8/dc6/classserial_a6812c510f66290224673cec091478bea.html#a6812c510f66290224673cec091478bea">00108</a>     <span class="keyword">public</span> function <a class="code" href="../../d8/dc6/classserial_a6812c510f66290224673cec091478bea.html#a6812c510f66290224673cec091478bea">getKardexes</a>()
<a name="l00109"></a>00109     {
<a name="l00110"></a>00110         $_kardex = array();
<a name="l00111"></a>00111         $_kardex_q = $this-&gt;obj_db-&gt;query(<span class="stringliteral">&apos;SELECT * FROM kardex WHERE serial_id=&apos;</span>.$this-&gt;serial_id.<span class="stringliteral">&apos; ORDER BY date_expected ASC LIMIT 365&apos;</span>);
<a name="l00112"></a>00112         <span class="keywordflow">while</span> ($_kardex_d = $_kardex_q-&gt;fetch_assoc()) {
<a name="l00113"></a>00113             $_kardex[] = $_kardex_d;
<a name="l00114"></a>00114         }
<a name="l00115"></a>00115         <span class="keywordflow">return</span> $_kardex;
<a name="l00116"></a>00116     }
<a name="l00117"></a>00117 
<a name="l00118"></a>00118 
<a name="l00123"></a><a class="code" href="../../d8/dc6/classserial_aa0cedb25a9017c92c4f068f68f8b3b42.html#aa0cedb25a9017c92c4f068f68f8b3b42">00123</a>     <span class="keyword">public</span> function <a class="code" href="../../d8/dc6/classserial_aa0cedb25a9017c92c4f068f68f8b3b42.html#aa0cedb25a9017c92c4f068f68f8b3b42">viewKardexes</a>()
<a name="l00124"></a>00124     {
<a name="l00125"></a>00125         $_can_read = <a class="code" href="../../d4/d71/classutility_aa47a7d75c82beaf71442437f6467a87e.html#aa47a7d75c82beaf71442437f6467a87e">utility::havePrivilege</a>(<span class="stringliteral">&apos;serial_control&apos;</span>, <span class="charliteral">&apos;r&apos;</span>);
<a name="l00126"></a>00126         $_can_write = <a class="code" href="../../d4/d71/classutility_aa47a7d75c82beaf71442437f6467a87e.html#aa47a7d75c82beaf71442437f6467a87e">utility::havePrivilege</a>(<span class="stringliteral">&apos;serial_control&apos;</span>, <span class="charliteral">&apos;w&apos;</span>);
<a name="l00127"></a>00127         <span class="comment">// start the output buffer</span>
<a name="l00128"></a>00128         ob_start();
<a name="l00129"></a>00129         ?&gt;
<a name="l00130"></a>00130         &lt;script type=<span class="stringliteral">&quot;text/javascript&quot;</span>&gt;
<a name="l00131"></a>00131         function confirmProcess(int_serial_id, int_kardex_id)
<a name="l00132"></a>00132         {
<a name="l00133"></a>00133             var confirmBox = confirm(<span class="stringliteral">&apos;Are you sure to remove selected Kardex data?&apos;</span> + <span class="stringliteral">&quot;\n&quot;</span> + <span class="stringliteral">&apos;Once deleted, it can\&apos;t be restored!&apos;</span>);
<a name="l00134"></a>00134             <span class="keywordflow">if</span> (confirmBox) {
<a name="l00135"></a>00135                 <span class="comment">// set hidden element value</span>
<a name="l00136"></a>00136                 document.hiddenActionForm.serialID.value = int_serial_id;
<a name="l00137"></a>00137                 document.hiddenActionForm.remove.value = int_kardex_id;
<a name="l00138"></a>00138                 <span class="comment">// submit form</span>
<a name="l00139"></a>00139                 document.hiddenActionForm.submit();
<a name="l00140"></a>00140             }
<a name="l00141"></a>00141         }
<a name="l00142"></a>00142         &lt;/script&gt;
<a name="l00143"></a>00143         &lt;?php
<a name="l00144"></a>00144         $_table = <span class="keyword">new</span> <a class="code" href="../../dc/dd3/classsimbio__table.html">simbio_table</a>();
<a name="l00145"></a>00145         $_table-&gt;table_attr = <span class="stringliteral">&apos;align=&quot;center&quot; class=&quot;detailTable&quot; style=&quot;width: 100%;&quot; cellpadding=&quot;2&quot; cellspacing=&quot;0&quot;&apos;</span>;
<a name="l00146"></a>00146         $_table-&gt;table_header_attr = <span class="stringliteral">&apos;class=&quot;dataListHeader&quot; style=&quot;font-weight: bold;&quot;&apos;</span>;
<a name="l00147"></a>00147         $_table-&gt;highlight_row = <span class="keyword">true</span>;
<a name="l00148"></a>00148         $_table-&gt;setHeader(array(<span class="stringliteral">&apos;&amp;nbsp;&apos;</span>, <a class="code" href="../../dd/df5/gettext_8inc_a7c8278de493ce8c0604694d31ffdc7cf.html#a7c8278de493ce8c0604694d31ffdc7cf">__</a>(<span class="stringliteral">&apos;Date Expected&apos;</span>),
<a name="l00149"></a>00149             <a class="code" href="../../dd/df5/gettext_8inc_a7c8278de493ce8c0604694d31ffdc7cf.html#a7c8278de493ce8c0604694d31ffdc7cf">__</a>(<span class="stringliteral">&apos;Date Received&apos;</span>), <a class="code" href="../../dd/df5/gettext_8inc_a7c8278de493ce8c0604694d31ffdc7cf.html#a7c8278de493ce8c0604694d31ffdc7cf">__</a>(<span class="stringliteral">&apos;Seq. Number&apos;</span>),
<a name="l00150"></a>00150             <a class="code" href="../../dd/df5/gettext_8inc_a7c8278de493ce8c0604694d31ffdc7cf.html#a7c8278de493ce8c0604694d31ffdc7cf">__</a>(<span class="stringliteral">&apos;Note&apos;</span>)));
<a name="l00151"></a>00151 
<a name="l00152"></a>00152         <span class="keywordflow">if</span> ($_can_read AND $_can_write) {
<a name="l00153"></a>00153             $_add_link = <span class="stringliteral">&apos;&lt;span title=&quot;Add New Kardex&quot; class=&quot;extendLink&quot;&gt;&amp;nbsp;&lt;/span&gt;&apos;</span>;
<a name="l00154"></a>00154             $_date_exp = <a class="code" href="../../da/d23/classsimbio__form__element_a35b9ee87688cbd324530099ba88a3416.html#a35b9ee87688cbd324530099ba88a3416">simbio_form_element::dateField</a>(<span class="stringliteral">&apos;dateExpected[0]&apos;</span>);
<a name="l00155"></a>00155             $_date_rec = <a class="code" href="../../da/d23/classsimbio__form__element_a35b9ee87688cbd324530099ba88a3416.html#a35b9ee87688cbd324530099ba88a3416">simbio_form_element::dateField</a>(<span class="stringliteral">&apos;dateReceived[0]&apos;</span>);
<a name="l00156"></a>00156             $_seq_num = <a class="code" href="../../da/d23/classsimbio__form__element_a7cbc300ccd88ebf08007b2caf3cefe6b.html#a7cbc300ccd88ebf08007b2caf3cefe6b">simbio_form_element::textField</a>(<span class="stringliteral">&apos;text&apos;</span>, <span class="stringliteral">&apos;seqNumber[0]&apos;</span>, <span class="stringliteral">&apos;&apos;</span>, <span class="stringliteral">&apos;width: 100%;&apos;</span>);
<a name="l00157"></a>00157             $_notes = <a class="code" href="../../da/d23/classsimbio__form__element_a7cbc300ccd88ebf08007b2caf3cefe6b.html#a7cbc300ccd88ebf08007b2caf3cefe6b">simbio_form_element::textField</a>(<span class="stringliteral">&apos;text&apos;</span>, <span class="stringliteral">&apos;notes[0]&apos;</span>, <span class="stringliteral">&apos;&apos;</span>, <span class="stringliteral">&apos;width: 100%;&apos;</span>);
<a name="l00158"></a>00158 
<a name="l00159"></a>00159             $_table-&gt;appendTableRow(array($_add_link, $_date_exp, $_date_rec, $_seq_num, $_notes));
<a name="l00160"></a>00160             $_table-&gt;setCellAttr(1, null, <span class="stringliteral">&apos;valign=&quot;top&quot; class=&quot;alterCell2&quot; style=&quot;font-weight: bold; width: auto;&quot;&apos;</span>);
<a name="l00161"></a>00161             $_table-&gt;setCellAttr(1, 0, <span class="stringliteral">&apos;valign=&quot;top&quot; class=&quot;alterCell2&quot; style=&quot;font-weight: bold; width: 5%;&quot;&apos;</span>);
<a name="l00162"></a>00162             $_table-&gt;setCellAttr(1, 1, <span class="stringliteral">&apos;valign=&quot;top&quot; class=&quot;alterCell2&quot; style=&quot;font-weight: bold; width: 25%;&quot;&apos;</span>);
<a name="l00163"></a>00163             $_table-&gt;setCellAttr(1, 2, <span class="stringliteral">&apos;valign=&quot;top&quot; class=&quot;alterCell2&quot; style=&quot;font-weight: bold; width: 25%;&quot;&apos;</span>);
<a name="l00164"></a>00164         }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166         $_row = 2;
<a name="l00167"></a>00167         <span class="keywordflow">foreach</span> ($this-&gt;<a class="code" href="../../d8/dc6/classserial_a6812c510f66290224673cec091478bea.html#a6812c510f66290224673cec091478bea">getKardexes</a>() as $_kardex) {
<a name="l00168"></a>00168             <span class="comment">// alternate the row color</span>
<a name="l00169"></a>00169             $_row_class = ($_row%2 == 0)?<span class="stringliteral">&apos;alterCell&apos;</span>:<span class="stringliteral">&apos;alterCell2&apos;</span>;
<a name="l00170"></a>00170 
<a name="l00171"></a>00171 
<a name="l00172"></a>00172             <span class="keywordflow">if</span> ($_can_read AND $_can_write) {
<a name="l00173"></a>00173                 <span class="comment">// kardex removal links</span>
<a name="l00174"></a>00174                 $_remove_link = <span class="stringliteral">&apos;&lt;a href=&quot;#&quot; onclick=&quot;confirmProcess(&apos;</span>.$this-&gt;serial_id.<span class="stringliteral">&apos;, &apos;</span>.$_kardex[<span class="stringliteral">&apos;kardex_id&apos;</span>].<span class="stringliteral">&apos;)&quot; class=&quot;trashLink&quot;&gt;&amp;nbsp;&lt;/a&gt;&apos;</span>;
<a name="l00175"></a>00175                 $_date_exp = <a class="code" href="../../da/d23/classsimbio__form__element_a35b9ee87688cbd324530099ba88a3416.html#a35b9ee87688cbd324530099ba88a3416">simbio_form_element::dateField</a>(<span class="stringliteral">&apos;dateExpected[&apos;</span>.$_kardex[<span class="stringliteral">&apos;kardex_id&apos;</span>].<span class="charliteral">&apos;]&apos;</span>, $_kardex[<span class="stringliteral">&apos;date_expected&apos;</span>]);
<a name="l00176"></a>00176                 $_date_rec = <a class="code" href="../../da/d23/classsimbio__form__element_a35b9ee87688cbd324530099ba88a3416.html#a35b9ee87688cbd324530099ba88a3416">simbio_form_element::dateField</a>(<span class="stringliteral">&apos;dateReceived[&apos;</span>.$_kardex[<span class="stringliteral">&apos;kardex_id&apos;</span>].<span class="charliteral">&apos;]&apos;</span>, $_kardex[<span class="stringliteral">&apos;date_received&apos;</span>]);
<a name="l00177"></a>00177                 $_seq_num = <a class="code" href="../../da/d23/classsimbio__form__element_a7cbc300ccd88ebf08007b2caf3cefe6b.html#a7cbc300ccd88ebf08007b2caf3cefe6b">simbio_form_element::textField</a>(<span class="stringliteral">&apos;text&apos;</span>, <span class="stringliteral">&apos;seqNumber[&apos;</span>.$_kardex[<span class="stringliteral">&apos;kardex_id&apos;</span>].<span class="charliteral">&apos;]&apos;</span>, $_kardex[<span class="stringliteral">&apos;seq_number&apos;</span>], <span class="stringliteral">&apos;width: 100%;&apos;</span>);
<a name="l00178"></a>00178                 $_notes = <a class="code" href="../../da/d23/classsimbio__form__element_a7cbc300ccd88ebf08007b2caf3cefe6b.html#a7cbc300ccd88ebf08007b2caf3cefe6b">simbio_form_element::textField</a>(<span class="stringliteral">&apos;text&apos;</span>, <span class="stringliteral">&apos;notes[&apos;</span>.$_kardex[<span class="stringliteral">&apos;kardex_id&apos;</span>].<span class="charliteral">&apos;]&apos;</span>, $_kardex[<span class="stringliteral">&apos;notes&apos;</span>], <span class="stringliteral">&apos;width: 100%;&apos;</span>);
<a name="l00179"></a>00179             } <span class="keywordflow">else</span> {
<a name="l00180"></a>00180                 $_remove_link = <span class="stringliteral">&apos;&amp;nbsp;&apos;</span>;
<a name="l00181"></a>00181                 $_date_exp = $_kardex[<span class="stringliteral">&apos;date_expected&apos;</span>]; $_date_rec = $_kardex[<span class="stringliteral">&apos;date_received&apos;</span>];
<a name="l00182"></a>00182                 $_seq_num = $_kardex[<span class="stringliteral">&apos;seq_number&apos;</span>]; $_notes = $_kardex[<span class="stringliteral">&apos;notes&apos;</span>];
<a name="l00183"></a>00183             }
<a name="l00184"></a>00184 
<a name="l00185"></a>00185             $_table-&gt;appendTableRow(array($_remove_link, $_date_exp, $_date_rec, $_seq_num, $_notes));
<a name="l00186"></a>00186             $_table-&gt;setCellAttr($_row, null, <span class="stringliteral">&apos;valign=&quot;top&quot; class=&quot;&apos;</span>.$_row_class.<span class="stringliteral">&apos;&quot; style=&quot;font-weight: bold; width: auto;&quot;&apos;</span>);
<a name="l00187"></a>00187             $_table-&gt;setCellAttr($_row, 0, <span class="stringliteral">&apos;valign=&quot;top&quot; class=&quot;&apos;</span>.$_row_class.<span class="stringliteral">&apos;&quot; style=&quot;font-weight: bold; width: 5%;&quot;&apos;</span>);
<a name="l00188"></a>00188             $_table-&gt;setCellAttr($_row, 1, <span class="stringliteral">&apos;valign=&quot;top&quot; class=&quot;&apos;</span>.$_row_class.<span class="stringliteral">&apos;&quot; style=&quot;font-weight: bold; width: 25%;&quot;&apos;</span>);
<a name="l00189"></a>00189             $_table-&gt;setCellAttr($_row, 2, <span class="stringliteral">&apos;valign=&quot;top&quot; class=&quot;&apos;</span>.$_row_class.<span class="stringliteral">&apos;&quot; style=&quot;font-weight: bold; width: 25%;&quot;&apos;</span>);
<a name="l00190"></a>00190 
<a name="l00191"></a>00191             $_row++;
<a name="l00192"></a>00192         }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194         <span class="comment">// button</span>
<a name="l00195"></a>00195         $_button_grp = <span class="stringliteral">&apos;&lt;div style=&quot;padding: 3px; background: #999999;&quot;&gt;&lt;input type=&quot;submit&quot; class=&quot;button&quot; name=&quot;saveKardexes&quot; value=&quot;&apos;</span>.__(<span class="stringliteral">&apos;Save&apos;</span>).<span class="stringliteral">&apos;&quot; /&gt;&lt;/div&gt;&apos;</span>;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197         <span class="comment">// header</span>
<a name="l00198"></a>00198         echo <span class="stringliteral">&apos;&lt;div style=&quot;padding: 5px; background: #CCCCCC;&quot;&gt;&apos;</span>.__(<span class="stringliteral">&apos;Kardex Detail for subscription&apos;</span>).<span class="stringliteral">&apos; &lt;strong&gt;&apos;</span>.$this-&gt;serial_period.<span class="stringliteral">&apos;&lt;/strong&gt;&lt;/div&gt;&apos;</span>;
<a name="l00199"></a>00199         <span class="keywordflow">if</span> ($_can_read AND $_can_write) {
<a name="l00200"></a>00200             echo <span class="stringliteral">&apos;&lt;form method=&quot;post&quot; name=&quot;kardexListForm&quot; id=&quot;kardexListForm&quot; action=&quot;&apos;</span>.$_SERVER[<span class="stringliteral">&apos;PHP_SELF&apos;</span>].<span class="stringliteral">&apos;&quot;&gt;&apos;</span>;
<a name="l00201"></a>00201             echo $_button_grp;
<a name="l00202"></a>00202         }
<a name="l00203"></a>00203         echo $_table-&gt;printTable();
<a name="l00204"></a>00204         <span class="keywordflow">if</span> ($_can_read AND $_can_write) {
<a name="l00205"></a>00205             echo $_button_grp;
<a name="l00206"></a>00206             echo <a class="code" href="../../da/d23/classsimbio__form__element_a463574a53afe256436c603d4e0985b0a.html#a463574a53afe256436c603d4e0985b0a">simbio_form_element::hiddenField</a>(<span class="stringliteral">&apos;serialID&apos;</span>, $this-&gt;serial_id);
<a name="l00207"></a>00207             echo <span class="stringliteral">&apos;&lt;/form&gt;&apos;</span>;
<a name="l00208"></a>00208             <span class="comment">// hidden form</span>
<a name="l00209"></a>00209             echo <span class="stringliteral">&apos;&lt;form name=&quot;hiddenActionForm&quot; method=&quot;post&quot; action=&quot;&apos;</span>.$_SERVER[<span class="stringliteral">&apos;PHP_SELF&apos;</span>].<span class="stringliteral">&apos;&quot;&gt;&lt;input type=&quot;hidden&quot; name=&quot;serialID&quot; value=&quot;0&quot; /&gt;&lt;input type=&quot;hidden&quot; name=&quot;remove&quot; value=&quot;0&quot; /&gt;&lt;/form&gt;&apos;</span>;
<a name="l00210"></a>00210         }
<a name="l00211"></a>00211         <span class="comment">/* main content end */</span>
<a name="l00212"></a>00212         $_content = ob_get_clean();
<a name="l00213"></a>00213 
<a name="l00214"></a>00214         <span class="keywordflow">return</span> $_content;
<a name="l00215"></a>00215     }
<a name="l00216"></a>00216 
<a name="l00217"></a>00217 
<a name="l00222"></a><a class="code" href="../../d8/dc6/classserial_ad9b5c238c4baf97d9282459c1928e638.html#ad9b5c238c4baf97d9282459c1928e638">00222</a>     <span class="keyword">public</span> function <a class="code" href="../../d8/dc6/classserial_ad9b5c238c4baf97d9282459c1928e638.html#ad9b5c238c4baf97d9282459c1928e638">saveKardexes</a>()
<a name="l00223"></a>00223     {
<a name="l00224"></a>00224         $_serialID = (integer)$_POST[<span class="stringliteral">&apos;serialID&apos;</span>];
<a name="l00225"></a>00225         <span class="comment">// iterate trough dateExpected</span>
<a name="l00226"></a>00226         <span class="keywordflow">foreach</span> ($_POST[<span class="stringliteral">&apos;dateExpected&apos;</span>] as $_kardexID =&gt; $_kardex_d) {
<a name="l00227"></a>00227             $_date_expected = trim($this-&gt;obj_db-&gt;escape_string($_kardex_d));
<a name="l00228"></a>00228             <span class="keywordflow">if</span> (!$_date_expected) {
<a name="l00229"></a>00229                 <span class="keywordflow">continue</span>;
<a name="l00230"></a>00230             }
<a name="l00231"></a>00231             $_date_received = trim($this-&gt;obj_db-&gt;escape_string($_POST[<span class="stringliteral">&apos;dateReceived&apos;</span>][$_kardexID]));
<a name="l00232"></a>00232             $_seq_number = trim($this-&gt;obj_db-&gt;escape_string($_POST[<span class="stringliteral">&apos;seqNumber&apos;</span>][$_kardexID]));
<a name="l00233"></a>00233             $_notes = trim($this-&gt;obj_db-&gt;escape_string($_POST[<span class="stringliteral">&apos;notes&apos;</span>][$_kardexID]));
<a name="l00234"></a>00234             <span class="comment">// data checking</span>
<a name="l00235"></a>00235             $_date_received = !empty($_date_received)?<span class="charliteral">&apos;\&apos;&apos;</span>.$_date_received.<span class="charliteral">&apos;\&apos;&apos;</span>:<span class="stringliteral">&apos;NULL&apos;</span>;
<a name="l00236"></a>00236             $_seq_number = !empty($_seq_number)?<span class="charliteral">&apos;\&apos;&apos;</span>.$_seq_number.<span class="charliteral">&apos;\&apos;&apos;</span>:<span class="stringliteral">&apos;NULL&apos;</span>;
<a name="l00237"></a>00237             $_notes = !empty($_notes)?<span class="charliteral">&apos;\&apos;&apos;</span>.$_notes.<span class="charliteral">&apos;\&apos;&apos;</span>:<span class="stringliteral">&apos;NULL&apos;</span>;
<a name="l00238"></a>00238             <span class="comment">// do update</span>
<a name="l00239"></a>00239             <span class="keywordflow">if</span> ($_kardexID == 0) {
<a name="l00240"></a>00240                 @$this-&gt;obj_db-&gt;query(<span class="stringliteral">&quot;INSERT INTO kardex (serial_id, date_expected, date_received, seq_number, notes) VALUES ($_serialID, &apos;$_date_expected&apos;, $_date_received, $_seq_number, $_notes)&quot;</span>);
<a name="l00241"></a>00241             } <span class="keywordflow">else</span> {
<a name="l00242"></a>00242                 @$this-&gt;obj_db-&gt;query(<span class="stringliteral">&quot;UPDATE kardex SET date_expected=&apos;$_date_expected&apos;,</span>
<a name="l00243"></a>00243 <span class="stringliteral">                    date_received=$_date_received, seq_number=$_seq_number, notes=$_notes WHERE kardex_id=$_kardexID AND serial_id=$_serialID&quot;</span>);
<a name="l00244"></a>00244             }
<a name="l00245"></a>00245         }
<a name="l00246"></a>00246     }
<a name="l00247"></a>00247 
<a name="l00248"></a>00248 
<a name="l00254"></a><a class="code" href="../../d8/dc6/classserial_a6f9d048f2009caf7949c4a249f7d434e.html#a6f9d048f2009caf7949c4a249f7d434e">00254</a>     <span class="keyword">public</span> function <a class="code" href="../../d8/dc6/classserial_a6f9d048f2009caf7949c4a249f7d434e.html#a6f9d048f2009caf7949c4a249f7d434e">deleteKardex</a>($int_kardex_id)
<a name="l00255"></a>00255     {
<a name="l00256"></a>00256         $_kardexID = (integer)$int_kardex_id;
<a name="l00257"></a>00257         $_delete = $this-&gt;obj_db-&gt;query(<span class="stringliteral">&apos;DELETE FROM kardex WHERE kardex_id=&apos;</span>.$int_kardex_id);
<a name="l00258"></a>00258         <span class="keywordflow">if</span> ($this-&gt;obj_db-&gt;affected_rows &gt; 0) {
<a name="l00259"></a>00259             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00260"></a>00260         }
<a name="l00261"></a>00261         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00262"></a>00262     }
<a name="l00263"></a>00263 }
<a name="l00264"></a>00264 ?&gt;
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on Fri Oct 16 20:43:20 2009 for Senayan3 by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
